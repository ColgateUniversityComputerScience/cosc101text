
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>9. Recursion &#8212; Solving Problems with Python (version 07.2015)</title>
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="10. File input and output" href="fileio.html" />
    <link rel="prev" title="8. Strings" href="strings.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fileio.html" title="10. File input and output"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="strings.html" title="8. Strings"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Solving Problems with Python (version 07.2015)</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">9. Recursion</a><ul>
<li><a class="reference internal" href="#chicken-meet-egg">9.1. Chicken, meet egg</a></li>
<li><a class="reference internal" href="#decrease-and-conquer">9.2. Decrease and conquer</a></li>
<li><a class="reference internal" href="#infinite-recursion">9.3. Infinite recursion</a></li>
<li><a class="reference internal" href="#leap-of-faith">9.4. Leap of faith</a></li>
<li><a class="reference internal" href="#two-more-examples">9.5. Two more examples</a><ul>
<li><a class="reference internal" href="#factorial">9.5.1. Factorial</a></li>
<li><a class="reference internal" href="#palindromes">9.5.2. Palindromes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#checking-types">9.6. Checking types</a></li>
<li><a class="reference internal" href="#a-theoretical-aside">9.7. A theoretical aside</a></li>
<li><a class="reference internal" href="#debugging">9.8. Debugging</a></li>
<li><a class="reference internal" href="#glossary">9.9. Glossary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="strings.html"
                        title="previous chapter">8. Strings</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fileio.html"
                        title="next chapter">10. File input and output</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/recursion.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="recursion">
<h1>9. Recursion<a class="headerlink" href="#recursion" title="Permalink to this headline">¶</a></h1>
<div class="section" id="chicken-meet-egg">
<h2>9.1. Chicken, meet egg<a class="headerlink" href="#chicken-meet-egg" title="Permalink to this headline">¶</a></h2>
<p>It is legal for one function to call another; it is also legal for a
function to call itself. It may not be obvious why that is a good thing,
but it turns out to be one of the most magical things a program can do.
A function that calls itself is <strong>recursive</strong>; the process is called
<strong>recursion</strong>.</p>
<p>A recursive definition is similar to a circular definition, in the sense
that the definition contains a reference to the thing being defined. A
truly circular definition is not very useful:</p>
<dl class="docutils">
<dt>frabjous:</dt>
<dd>An adjective used to describe something that is frabjous.</dd>
</dl>
<p>If you saw that definition in the dictionary, you might be annoyed (in
which case, you might want to check out &quot;recursive acronyms&quot;!
<a class="reference external" href="http://en.wikipedia.org/wiki/Recursive_acronym">http://en.wikipedia.org/wiki/Recursive_acronym</a>). On the other hand, if
you looked up the definition of the factorial function, denoted with the
symbol <span class="math notranslate nohighlight">\(!\)</span>, you might get something like this:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math notranslate nohighlight">\(0! = 1\)</span></li>
<li><span class="math notranslate nohighlight">\(n! = n * (n-1)!\)</span></li>
</ul>
</div></blockquote>
<p>This definition says that the factorial of 0 is 1, and the factorial of
any other value, <span class="math notranslate nohighlight">\(n\)</span>, is <span class="math notranslate nohighlight">\(n\)</span> multiplied by the factorial of
<span class="math notranslate nohighlight">\(n-1\)</span>.</p>
<p>So <span class="math notranslate nohighlight">\(3!\)</span> is 3 times <span class="math notranslate nohighlight">\(2!\)</span>, which is 2 times <span class="math notranslate nohighlight">\(1!\)</span>, which
is 1 times <span class="math notranslate nohighlight">\(0!\)</span>. Putting it all together, <span class="math notranslate nohighlight">\(3!\)</span> equals 3
times 2 times 1 times 1, which is 6.</p>
<p>If you can write a recursive definition of something, you can usually
write a Python program to evaluate it. The first step is to decide what
the parameters should be. In this case it should be clear that
<code class="docutils literal notranslate"><span class="pre">factorial</span></code> takes an integer:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</pre></div>
</div>
<p>If the argument happens to be 0, all we have to do is return 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Otherwise, and this is the interesting part, we have to make a recursive
call to find the factorial of <span class="math notranslate nohighlight">\(n-1\)</span> and then multiply it by
<span class="math notranslate nohighlight">\(n\)</span>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">recurse</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p>If we call <code class="docutils literal notranslate"><span class="pre">factorial</span></code> with the value 3:</p>
<blockquote>
<div><p>Since 3 is not 0, we take the second branch and calculate the
factorial of <code class="docutils literal notranslate"><span class="pre">n-1</span></code>...</p>
<blockquote>
<div><p>Since 2 is not 0, we take the second branch and calculate the
factorial of <code class="docutils literal notranslate"><span class="pre">n-1</span></code>...</p>
<blockquote>
<div><p>Since 1 is not 0, we take the second branch and calculate
the factorial of <code class="docutils literal notranslate"><span class="pre">n-1</span></code>...</p>
<blockquote>
<div>Since 0 <em>is</em> 0, we take the first branch and return 1
without making any more recursive calls.</div></blockquote>
<p>The return value (1) is multiplied by <span class="math notranslate nohighlight">\(n\)</span>, which is 1,
and the result is returned.</p>
</div></blockquote>
<p>The return value (1) is multiplied by <span class="math notranslate nohighlight">\(n\)</span>, which is 2, and
the result is returned.</p>
</div></blockquote>
<p>The return value (2) is multiplied by <span class="math notranslate nohighlight">\(n\)</span>, which is 3, and the
result, 6, becomes the return value of the function call that
started the whole process.</p>
</div></blockquote>
<p>Here is what the stack diagram looks like for this sequence of function
calls:</p>
<div class="figure align-center" id="id9">
<img alt="Stack diagram for ``factorial(3)``" src="_images/stack3.png" />
<p class="caption"><span class="caption-text">Stack diagram for <code class="docutils literal notranslate"><span class="pre">factorial(3)</span></code></span></p>
</div>
<p>The four frames have different values for the parameter <code class="docutils literal notranslate"><span class="pre">n</span></code>. The
return values are shown being passed back up the stack. In each frame,
the return value is the value of <code class="docutils literal notranslate"><span class="pre">result</span></code>, which is the product of
<code class="docutils literal notranslate"><span class="pre">n</span></code> and <code class="docutils literal notranslate"><span class="pre">recurse</span></code>.</p>
<p>The bottom of the stack, where <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">0</span></code>, is referred to as the <strong>base
case</strong>. It does not make a recursive call, so there are no more stack
frames. Also, in the last frame, the local variables <code class="docutils literal notranslate"><span class="pre">recurse</span></code> and
<code class="docutils literal notranslate"><span class="pre">result</span></code> do not exist, because the branch that creates them does not
execute.</p>
</div>
<div class="section" id="decrease-and-conquer">
<h2>9.2. Decrease and conquer<a class="headerlink" href="#decrease-and-conquer" title="Permalink to this headline">¶</a></h2>
<p>Recursion as a programming technique lends itself well to a problem
solving strategy called <strong>decrease and conquer</strong>. The basic idea is to
consider how a problem can be formulated in terms of &quot;smaller&quot; versions
of itself. In the case of the <code class="docutils literal notranslate"><span class="pre">factorial</span></code> function, we directly use
the mathematical definition to accomplish this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The right-hand side of the statement <em>decreases</em> the problem size
(<code class="docutils literal notranslate"><span class="pre">n</span></code>) by one, and recursively invokes the <code class="docutils literal notranslate"><span class="pre">factorial</span></code> function.
Since this statement recursively reduces the problem size, we eventually
reach the <strong>base case</strong> (i.e., <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code>), at which point the recursion
stops.</p>
<p>The strategy discussed earlier, <em>divide and conquer</em> is also useful when
thinking about solving problems recursively. If a problem can be divided
into smaller, non-overlapping versions of itself, a recursive approach
may be appropriate. In the searching and sorting chapters, we'll see an
examples of two problems that fit this approach.</p>
</div>
<div class="section" id="infinite-recursion">
<h2>9.3. Infinite recursion<a class="headerlink" href="#infinite-recursion" title="Permalink to this headline">¶</a></h2>
<p>If a recursion never reaches a base case, it goes on making recursive
calls forever, and the program never terminates. This is known as
<strong>infinite recursion</strong>, and it is generally not a good idea. Here is a
minimal program with an infinite recursion:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">recurse</span><span class="p">():</span>
    <span class="n">recurse</span><span class="p">()</span>
</pre></div>
</div>
<p>In most programming environments, a program with infinite recursion does
not really run forever. Python reports an error message when the maximum
recursion depth is reached:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">recurse</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">recurse</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">recurse</span>
                  <span class="o">.</span>
                  <span class="o">.</span>
                  <span class="o">.</span>
  <span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span><span class="p">,</span> <span class="ow">in</span> <span class="n">recurse</span>
<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Maximum</span> <span class="n">recursion</span> <span class="n">depth</span> <span class="n">exceeded</span>
</pre></div>
</div>
<p>This traceback is a little bigger than the one we saw in the previous
chapter. When the error occurs, there are 1000 <code class="docutils literal notranslate"><span class="pre">recurse</span></code> frames on the
stack!</p>
</div>
<div class="section" id="leap-of-faith">
<h2>9.4. Leap of faith<a class="headerlink" href="#leap-of-faith" title="Permalink to this headline">¶</a></h2>
<p>Following the flow of execution is one way to read programs, but it can
quickly become labyrinthine. An alternative approach is what might be
considered the &quot;leap of faith.&quot; When you come to a function call,
instead of following the flow of execution, you <em>assume</em> that the
function works correctly and returns the right result.</p>
<p>In fact, you are already practicing this leap of faith when you use
built-in functions. When you call <code class="docutils literal notranslate"><span class="pre">math.cos</span></code> or <code class="docutils literal notranslate"><span class="pre">math.exp</span></code>, you
don’t examine the bodies of those functions. You just assume that they
work because the people who wrote the built-in functions were good
programmers.</p>
<p>The same is true when you call one of your own functions. For example,
we previously wrote a function called <code class="docutils literal notranslate"><span class="pre">is_divisible</span></code> that determines
whether one number is divisible by another. Once we have convinced ourselves
that this function is correct—by examining the code and testing—we can
use the function without looking at the body again.</p>
<p>The same is true of recursive programs. When you get to the recursive
call, instead of following the flow of execution, you should assume that
the recursive call works (yields the correct result) and then ask
yourself, “Assuming that I can find the factorial of <span class="math notranslate nohighlight">\(n-1\)</span>, can I
compute the factorial of <span class="math notranslate nohighlight">\(n\)</span>?” In this case, it is clear that you
can, by multiplying by <span class="math notranslate nohighlight">\(n\)</span>.</p>
<p>Of course, it’s a bit strange to assume that the function works
correctly when you haven’t finished writing it, but that’s why it’s
called a leap of faith!</p>
</div>
<div class="section" id="two-more-examples">
<h2>9.5. Two more examples<a class="headerlink" href="#two-more-examples" title="Permalink to this headline">¶</a></h2>
<div class="section" id="factorial">
<h3>9.5.1. Factorial<a class="headerlink" href="#factorial" title="Permalink to this headline">¶</a></h3>
<p>After <code class="docutils literal notranslate"><span class="pre">factorial</span></code>, the most common example of a recursively defined
mathematical function is <code class="docutils literal notranslate"><span class="pre">fibonacci</span></code>. Similar to the <code class="docutils literal notranslate"><span class="pre">factorial</span></code>
function, it follows a <em>decrease and conquer</em> approach. The
<code class="docutils literal notranslate"><span class="pre">fibonacci</span></code> function has the following definition <a class="footnote-reference" href="#id5" id="id1">[1]</a>:</p>
<blockquote>
<div><ul class="simple">
<li><span class="math notranslate nohighlight">\(fibonacci(0) = 0\)</span></li>
<li><span class="math notranslate nohighlight">\(fibonacci(1) = 1\)</span></li>
<li><span class="math notranslate nohighlight">\(fibonacci(n) = fibonacci(n-1) + fibonacci(n-2)\)</span></li>
</ul>
</div></blockquote>
<p>Translated into Python, it looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fibonacci</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span>  <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that in the last line, the &quot;problem size&quot; (<code class="docutils literal notranslate"><span class="pre">n</span></code>) is reduced by
one or two. Eventually, we decrease the problem size to <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">0</span></code> or
<code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">1</span></code>. If you try to follow the flow of execution here, even for
fairly small values of <span class="math notranslate nohighlight">\(n\)</span>, your head explodes. But according to
the leap of faith, if you assume that the two recursive calls work
correctly, then it is clear that you get the right result by adding them
together.</p>
</div>
<div class="section" id="palindromes">
<h3>9.5.2. Palindromes<a class="headerlink" href="#palindromes" title="Permalink to this headline">¶</a></h3>
<p>Another problem that can solved with a recursive &quot;reduce and conquer&quot;
approach is to determine whether a string is a palindrome or not. A
string is a palindrome if it is spelled the same way backward and
forward. For example, the following words are palindromes:</p>
<ul class="simple">
<li>racecar</li>
<li>civic</li>
<li>kayak</li>
<li>rotator</li>
<li>testset</li>
</ul>
<p>The following phrase is also palindromic (assuming the punctuation is
removed, and we convert all characters to the same case):</p>
<blockquote>
<div>A man, a plan, a canal, Panama!</div></blockquote>
<p>This problem is a little bit different than the others we've seen, but
the idea of reducing the problem to a smaller size still holds. First,
we'll define a base case:</p>
<blockquote>
<div>A string of length 1 or less is a palindrome.</div></blockquote>
<p>Nothing very controversial there, right? And it suggests an approach:
try to reduce the size of the string until we have a string of length 1
or less.</p>
<p>The main bit of insight we need is to realize that for a string to be a
palindrome, <em>the first and last characters must be the same</em>. If they
are, we can slice off the first and last characters, thus reducing the
problem size! We can then check if the remaining string is a palindrome
--- recursion! If the first and last characters aren't the same, there's
no chance the string is a palindrome. Translating all that to a
function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">isPalindrome</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="c1"># string of 1 or fewer characters</span>
    <span class="c1"># is necessarily a palindrome</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

    <span class="c1"># if first and last characters are</span>
    <span class="c1"># the same, reduce the problem size,</span>
    <span class="c1"># and make recursive call</span>
    <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">newstring</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">isPalindrome</span><span class="p">(</span><span class="n">newstring</span><span class="p">)</span>

    <span class="c1"># no chance that we&#39;ve got a palindrome.</span>
    <span class="c1"># just return in abject failure.</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="checking-types">
<h2>9.6. Checking types<a class="headerlink" href="#checking-types" title="Permalink to this headline">¶</a></h2>
<p>What happens if we call <code class="docutils literal notranslate"><span class="pre">factorial</span></code> and give it 1.5 as an argument?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="go">RuntimeError: Maximum recursion depth exceeded</span>
</pre></div>
</div>
<p>It looks like an infinite recursion. But how can that be? There is a
base case—when <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">==</span> <span class="pre">0</span></code>. But if <code class="docutils literal notranslate"><span class="pre">n</span></code> is not an integer, we can <em>miss</em>
the base case and recurse forever.</p>
<p>In the first recursive call, the value of <code class="docutils literal notranslate"><span class="pre">n</span></code> is 0.5. In the next, it
is -0.5. From there, it gets smaller (more negative), but it will never
be 0.</p>
<p>We have two choices. We can try to generalize the <code class="docutils literal notranslate"><span class="pre">factorial</span></code> function
to work with floating-point numbers, or we can make <code class="docutils literal notranslate"><span class="pre">factorial</span></code> check
the type of its argument. The first option is called the gamma
function <a class="footnote-reference" href="#id6" id="id2">[2]</a> and it’s a little beyond the scope of this book. So we’ll
go for the second.</p>
<p>We can use the built-in function <code class="docutils literal notranslate"><span class="pre">isinstance</span></code> to verify the type of
the argument. While we’re at it, we can also make sure the argument is
positive:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span> <span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">print</span> <span class="s1">&#39;Factorial is only defined for integers.&#39;</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="s1">&#39;Factorial is not defined for negative integers.&#39;</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The first base case handles nonintegers; the second catches negative
integers. In both cases, the program prints an error message and returns
<code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate that something went wrong:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="s1">&#39;fred&#39;</span><span class="p">)</span>
<span class="go">Factorial is only defined for integers.</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">factorial</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
<span class="go">Factorial is not defined for negative integers.</span>
<span class="go">None</span>
</pre></div>
</div>
<p>If we get past both checks, then we know that <span class="math notranslate nohighlight">\(n\)</span> is positive or
zero, so we can prove that the recursion terminates.</p>
<p>This program demonstrates a pattern sometimes called a <strong>guardian</strong>. The
first two conditionals act as guardians, protecting the code that
follows from values that might cause an error. The guardians make it
possible to prove the correctness of the code.</p>
</div>
<div class="section" id="a-theoretical-aside">
<h2>9.7. A theoretical aside<a class="headerlink" href="#a-theoretical-aside" title="Permalink to this headline">¶</a></h2>
<p>We have only covered a subset of Python, but you might be interested to
know that this subset is a <em>complete</em> programming language, which means
that anything that can be computed can be expressed in this language.
Any program ever written could be rewritten using only the language
features you have learned so far (actually, you would need a few
commands to control devices like the keyboard, mouse, disks, etc., but
that’s all).</p>
<p>Proving that claim is a nontrivial exercise first accomplished by Alan
Turing, one of the first computer scientists (some would argue that he
was a mathematician, but a lot of early computer scientists started as
mathematicians). Accordingly, it is known as the Turing Thesis. For a
more complete (and accurate) discussion of the Turing Thesis, I
recommend Michael Sipser’s book <em>Introduction to the Theory of
Computation</em>.</p>
</div>
<div class="section" id="debugging">
<h2>9.8. Debugging<a class="headerlink" href="#debugging" title="Permalink to this headline">¶</a></h2>
<p>Adding print statements at the beginning and end of a function can help
make the flow of execution more visible, especially when debugging
recursive functions. For example, here is a version of <code class="docutils literal notranslate"><span class="pre">factorial</span></code>
with print statements:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">space</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">n</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">space</span><span class="p">,</span> <span class="s1">&#39;factorial&#39;</span><span class="p">,</span> <span class="n">n</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">space</span><span class="p">,</span> <span class="s1">&#39;returning 1&#39;</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">recurse</span> <span class="o">=</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">recurse</span>
        <span class="k">print</span> <span class="n">space</span><span class="p">,</span> <span class="s1">&#39;returning&#39;</span><span class="p">,</span> <span class="n">result</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">space</span></code> is a string of space characters that controls the indentation
of the output. Here is the result of <code class="docutils literal notranslate"><span class="pre">factorial(5)</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                    <span class="n">factorial</span> <span class="mi">5</span>
                <span class="n">factorial</span> <span class="mi">4</span>
            <span class="n">factorial</span> <span class="mi">3</span>
        <span class="n">factorial</span> <span class="mi">2</span>
    <span class="n">factorial</span> <span class="mi">1</span>
<span class="n">factorial</span> <span class="mi">0</span>
<span class="n">returning</span> <span class="mi">1</span>
    <span class="n">returning</span> <span class="mi">1</span>
        <span class="n">returning</span> <span class="mi">2</span>
            <span class="n">returning</span> <span class="mi">6</span>
                <span class="n">returning</span> <span class="mi">24</span>
                    <span class="n">returning</span> <span class="mi">120</span>
</pre></div>
</div>
<p>If you are confused about the flow of execution, this kind of output can
be helpful. It takes some time to develop effective scaffolding, but a
little bit of scaffolding can save a lot of debugging.</p>
</div>
<div class="section" id="glossary">
<h2>9.9. Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>recursion:</dt>
<dd>The process of calling the function that is currently executing.</dd>
<dt>base case:</dt>
<dd>A conditional branch in a recursive function that does not make a
recursive call.</dd>
<dt>infinite recursion:</dt>
<dd>A recursion that doesn’t have a base case, or never reaches it.
Eventually, an infinite recursion causes a runtime error.</dd>
</dl>
<p class="rubric">Exercises</p>
<ol class="arabic simple">
<li>Write a function that takes a possibly empty list of integers as
a parameter, and recursively computes and returns the sum of the
list of numbers. You can not use any built-in Python functions
except for <code class="docutils literal notranslate"><span class="pre">len</span></code>.</li>
<li>Write a function that takes a possibly empty string as a
parameter and recursively produces a reversed copy of the string.</li>
<li>Similar to the last problem, write a function that takes a
possibly empty <em>list</em> as a parameter (the list may contain <em>any</em>
Python data types), and recursively produces a reversed copy of
the list.</li>
<li>Read the following function and see if you can figure out what it
does, then run it.</li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">turtle</span>

<span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">turtle</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">length</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
    <span class="n">turtle</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">turtle</span><span class="o">.</span><span class="n">right</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">draw</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">turtle</span><span class="o">.</span><span class="n">left</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
    <span class="n">turtle</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">length</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>

<span class="n">draw</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">turtle</span><span class="o">.</span><span class="n">done</span><span class="p">()</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>The Koch curve is a fractal that looks something like this:</li>
</ol>
<div class="figure align-center" id="id10">
<img alt="Koch curve fractal." src="_images/koch.png" />
<p class="caption"><span class="caption-text">Koch curve fractal.</span></p>
</div>
<blockquote>
<div><p>To draw a Koch curve with length <span class="math notranslate nohighlight">\(x\)</span>, all you have to do is</p>
<ol class="arabic simple">
<li>Draw a Koch curve with length <span class="math notranslate nohighlight">\(x/3\)</span>.</li>
<li>Turn left 60 degrees.</li>
<li>Draw a Koch curve with length <span class="math notranslate nohighlight">\(x/3\)</span>.</li>
<li>Turn right 120 degrees.</li>
<li>Draw a Koch curve with length <span class="math notranslate nohighlight">\(x/3\)</span>.</li>
<li>Turn left 60 degrees.</li>
<li>Draw a Koch curve with length <span class="math notranslate nohighlight">\(x/3\)</span>.</li>
</ol>
<p>The only exception is if <span class="math notranslate nohighlight">\(x\)</span> is less than 3. In that case,
you can just draw a straight line with length <span class="math notranslate nohighlight">\(x\)</span>.</p>
<blockquote>
<div><ol class="loweralpha simple">
<li>Write a function called <code class="docutils literal notranslate"><span class="pre">koch</span></code> that takes a turtle and a
length as parameters, and that uses the turtle to draw a Koch
curve with the given length.</li>
<li>Write a function called <code class="docutils literal notranslate"><span class="pre">snowflake</span></code> that draws three Koch
curves to make the outline of a snowflake.</li>
<li>The Koch curve can be generalized in several ways. See
<a class="reference external" href="http://wikipedia.org/wiki/Koch_snowflake">http://wikipedia.org/wiki/Koch_snowflake</a> for examples and
implement your favorite.</li>
</ol>
</div></blockquote>
</div></blockquote>
<ol class="arabic" start="6">
<li><p class="first">The Ackermann function, <span class="math notranslate nohighlight">\(A(m, n)\)</span>, is defined <a class="footnote-reference" href="#id7" id="id3">[3]</a> as:</p>
<p><span class="math notranslate nohighlight">\(A(m,n) =\)</span></p>
<ul class="simple">
<li><span class="math notranslate nohighlight">\(n+1\)</span> if <span class="math notranslate nohighlight">\(m = 0\)</span></li>
<li><span class="math notranslate nohighlight">\(A(m-1,1)\)</span> if <span class="math notranslate nohighlight">\(m &gt; 0 and n = 0\)</span></li>
<li><span class="math notranslate nohighlight">\(A(m-1, A(m, n-1))\)</span> if <span class="math notranslate nohighlight">\(m &gt; 0\)</span> and <span class="math notranslate nohighlight">\(n &gt; 0\)</span></li>
</ul>
</li>
</ol>
<blockquote>
<div>Write a function named <cite>ack</cite> that evaluates Ackerman’s function.
Use your function to evaluate <cite>ack(3, 4)</cite>, which should be 125. What
happens for larger values of <cite>m</cite> and <cite>n</cite>?</div></blockquote>
<ol class="arabic" start="7">
<li><p class="first">A number, <span class="math notranslate nohighlight">\(a\)</span>, is a power of <span class="math notranslate nohighlight">\(b\)</span> if it is divisible
by <span class="math notranslate nohighlight">\(b\)</span> and <span class="math notranslate nohighlight">\(a/b\)</span> is a power of <span class="math notranslate nohighlight">\(b\)</span>. Write a
function called <code class="docutils literal notranslate"><span class="pre">is_power</span></code> that takes parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> and
<code class="docutils literal notranslate"><span class="pre">b</span></code> and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if <code class="docutils literal notranslate"><span class="pre">a</span></code> is a power of <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
</li>
<li><p class="first">The greatest common divisor (GCD) of <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> is
the largest number that divides both of them with no
remainder <a class="footnote-reference" href="#id8" id="id4">[4]</a>.</p>
<p>One way to find the GCD of two numbers is Euclid’s algorithm,
which is based on the observation that if <span class="math notranslate nohighlight">\(r\)</span> is the
remainder when <span class="math notranslate nohighlight">\(a\)</span> is divided by <span class="math notranslate nohighlight">\(b\)</span>, then
<span class="math notranslate nohighlight">\(gcd(a, b) = gcd(b, r)\)</span>. As a base case, we can consider
<span class="math notranslate nohighlight">\(gcd(a, 0) = a\)</span>.</p>
<p>Write a function called <code class="docutils literal notranslate"><span class="pre">gcd</span></code> that takes parameters <code class="docutils literal notranslate"><span class="pre">a</span></code> and
<code class="docutils literal notranslate"><span class="pre">b</span></code> and returns their greatest common divisor. If you need
help, see <a class="reference external" href="http://wikipedia.org/wiki/Euclidean_algorithm">http://wikipedia.org/wiki/Euclidean_algorithm</a>.</p>
</li>
</ol>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>See <a class="reference external" href="http://wikipedia.org/wiki/Fibonacci_number">http://wikipedia.org/wiki/Fibonacci_number</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>See <a class="reference external" href="http://wikipedia.org/wiki/Gamma_function">http://wikipedia.org/wiki/Gamma_function</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>See <a class="reference external" href="http://wikipedia.org/wiki/Ackermann_function">http://wikipedia.org/wiki/Ackermann_function</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>This exercise is based on an example from Abelson and Sussman’s
<em>Structure and Interpretation of Computer Programs</em>.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fileio.html" title="10. File input and output"
             >next</a> |</li>
        <li class="right" >
          <a href="strings.html" title="8. Strings"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Solving Problems with Python (version 07.2015)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2012-2015, Joel Sommers, Ed..
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.8.
    </div>
  </body>
</html>